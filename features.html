<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Features - Timepot</title>
    <link rel="stylesheet" href="styles.css">
    <script defer src="https://cloud.umami.is/script.js" data-website-id="44aec67b-1dc1-4330-8456-c14c21477512"></script>
    <script src="translations.js"></script>
    <script src="mobile-menu.js"></script>
</head>
<body>
    <!-- Header -->
    <header>
                <nav class="navbar">
            <div class="container">
                <div class="logo">
                    <a href="index.html" class="logo-link" aria-label="Timepot home">
                        <img src="assets/Timepot_Logo-positive.svg" alt="Timepot logo" class="site-logo">
                    </a>
                </div>
                <button class="hamburger" id="hamburger-btn" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <ul class="nav-links" id="nav-menu">
                    <li><a href="index.html" data-i18n="nav.home">How it Works</a></li>
                    <li><a href="#features" data-i18n="nav.features">Features</a></li>
                </ul>
            </div>
        </nav>
        <div class="menu-overlay" id="menu-overlay"></div>
    </header>

    <!-- Onboarding Section -->
    <section id="onboarding" class="onboarding-section">
        <div class="container">
            <div class="onboarding-content">
                <h2 data-i18n="onboarding.title">Let's personalize your Timepot experience</h2>
                <p data-i18n="onboarding.subtitle">Help us understand your family better so we can show you the most relevant features</p>
                
                <div class="onboarding-questions">
                    <!-- html -->
                    <div class="question-group">
                        <h3 data-i18n="onboarding.family-size.question">How many people are in your family?</h3>
                        <div class="family-size-buttons">
                            <button class="family-size-btn" type="button" data-family-size="1A-1K" aria-pressed="false">
                                <img src="assets/1%20Adult%201%20Kid.svg" alt="" aria-hidden="true">
                                <span class="sr-only" data-i18n="onboarding.family-size.1A-1K">1 Adult 1 Kid</span>
                            </button>

                            <button class="family-size-btn" type="button" data-family-size="2A-1K" aria-pressed="false">
                                <img src="assets/2%20Adults%201%20Kid.svg" alt="" aria-hidden="true">
                                <span class="sr-only" data-i18n="onboarding.family-size.2A-1K">2 Adults 1 Kid</span>
                            </button>

                            <button class="family-size-btn" type="button" data-family-size="1A-2K" aria-pressed="false">
                                <img src="assets/1%20Adult%202%20Kids.svg" alt="" aria-hidden="true">
                                <span class="sr-only" data-i18n="onboarding.family-size.1A-2K">1 Adult 2 Kids</span>
                            </button>

                            <button class="family-size-btn" type="button" data-family-size="2A-2K" aria-pressed="false">
                                <img src="assets/2%20Adults%202%20Kids.svg" alt="" aria-hidden="true">
                                <span class="sr-only" data-i18n="onboarding.family-size.2A-2K">2 Adults 2 Kids</span>
                            </button>

                            <button class="family-size-btn" type="button" data-family-size="1A-2plusK" aria-pressed="false">
                                <img src="assets/1%20Adult%202%2BKids.svg" alt="" aria-hidden="true">
                                <span class="sr-only" data-i18n="onboarding.family-size.1A-2plusK">1 Adult 2+ Kids</span>
                            </button>

                            <button class="family-size-btn" type="button" data-family-size="2A-2plusK" aria-pressed="false">
                                <img src="assets/2%20Adults%202%2BKids.svg" alt="" aria-hidden="true">
                                <span class="sr-only" data-i18n="onboarding.family-size.2A-2plusK">2 Adults 2+ Kids</span>
                            </button>


                        </div>
                    </div>

                    <div class="onboarding-actions">
                        <div class="family-size-none">
                            <button class="cta-button cta-ghost" id="no-kids" data-i18n="onboarding.no-kids">No Kids</button>
                        </div>
                    </div>

                    
                    <div class="question-group">
                        <h3 data-i18n="onboarding.device-age.question">When did your kids get their first smartphone/tablet?</h3>
                        <div class="option-buttons">
                            <button class="option-btn" data-device-age="1-2-years" data-i18n="onboarding.device-age.1-2-years">1-2 years ago</button>
                            <button class="option-btn" data-device-age="3-5-years" data-i18n="onboarding.device-age.3-5-years">3-5 years ago</button>
                            <button class="option-btn" data-device-age="6-10-years" data-i18n="onboarding.device-age.6-10-years">6-10 years ago</button>
                            <button class="option-btn" data-device-age="more-than-10" data-i18n="onboarding.device-age.more-than-10">More than 10 years ago</button>
                            <button class="option-btn" data-device-age="none" data-i18n="onboarding.device-age.none">They don't have smartphones yet</button>
                        </div>
                    </div>
                </div>
                
                <div class="onboarding-actions">
                    <button class="cta-button" id="continue-to-features" data-i18n="onboarding.cta">Show Me Features</button>
                    <button class="cta-button cta-ghost" id="skip-onboarding" data-i18n="onboarding.skip">Skip for now</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="features features-page">
        <div class="container">
            <h2 data-i18n="features-page.title">Click on a Feature to learn more!</h2>
            <div class="features-grid all-visible">
                <div class="feature-card" id="feature-card-heroes-villains">
                    <div class="feature-icon">
                        <img src="assets/icons_timepot-04.svg" alt="Privacy First Icon" />
                    </div>
                    <h3 data-i18n="feature.heroes-villains.title">Heroes & Villains System</h3>
                </div>
                <div class="feature-card" id="feature-card-agreements">
                    <div class="feature-icon">
                        <img src="assets/icons_timepot-01.svg" alt="Privacy First Icon" />
                    </div>                    <h3 data-i18n="feature.agreements.title">Agreements</h3>
                </div>
                <div class="feature-card" id="feature-card-privacy-first">
                    <div class="feature-icon">
                        <img src="assets/icons_timepot-03.svg" alt="Privacy First Icon" />
                    </div>
                    <h3 data-i18n="feature.privacy.title">Privacy</h3>
                    <h3>-</h3>
                    <h3 data-i18n="feature.privacy.subtitle">App Categories</h3>
                </div>
                <div class="feature-card" id="feature-card-individual-battle">
                    <div class="feature-icon">
                        <img src="assets/icons_timepot-06.svg" alt="Privacy First Icon" />
                    </div>
                    <h3 data-i18n="feature.individual.title">Reporting</h3>
                    <h3>-</h3>
                    <h3 data-i18n="feature.individual.subtitle">Individual Battle</h3>
                </div>
                <div class="feature-card" id="feature-card-team-battle">
                    <div class="feature-icon">
                        <img src="assets/icons_timepot-07.svg" alt="Privacy First Icon" />
                    </div>
                    <h3 data-i18n="feature.team.title">Reporting</h3>
                    <h3>-</h3>
                    <h3 data-i18n="feature.team.subtitle">Team Battle</h3>
                </div>
                <div class="feature-card" id="feature-card-family-family">
                    <div class="feature-icon">
                        <img src="assets/icons_timepot-08.svg" alt="Privacy First Icon" />
                    </div>
                    <h3 data-i18n="feature.family-vs-family.title">Reporting</h3>
                    <h3>-</h3>
                    <h3 data-i18n="feature.family-vs-family.subtitle">Family vs. Family</h3>
                </div>
            </div>
        </div>
    </section>


    <!-- Pricing Section -->
    <section id="pricing" class="pricing-section" style="display: none;">
        <div class="container">
            <h2 data-i18n="pricing.title">What Would You Pay?</h2>
            <div class="pricing-input-container">
                <label for="user-price-input" style="display: block; text-align: center; font-size: 1.1rem; margin-bottom: 1rem;" data-i18n="pricing.label">Monthly price, for the whole family</label>
                <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 2rem;">
                    <span id="currency-symbol" style="font-size: 2rem; font-weight: bold;">CHF</span>
                    <input
                            type="number"
                            id="user-price-input"
                            data-i18n-placeholder="pricing.placeholder"
                            placeholder="0.00"
                            min="0"
                            step="0.50"
                            style="width: 200px; padding: 1rem 1.5rem; font-size: 2rem; font-weight: bold; text-align: center; border: 3px solid var(--primary-color); border-radius: 12px; background: white;"
                    >
                    <span style="font-size: 1.2rem;" data-i18n="pricing.month">/month</span>
                </div>
                <button class="cta-button" id="submit-price-btn" style="width: 100%; max-width: 300px; margin: 0 auto; display: block; background: white; color: var(--primary-color); font-weight: 600;" data-i18n="pricing.cta">Continue</button>
            </div>
        </div>

        <div class="cta-container">
            <a href="waitlist.html" class="cta-button" id="waitlist-button-features" data-i18n="pricing.direct-waitlist">Join the Waitlist</a>
        </div>
        </div>

        </div>
    </section>





    <!-- Price Confirmation Modal -->
    <div id="price-confirmation-modal" class="modal">
        <div class="modal-content" style="text-align: center; padding: 3rem 2rem 2.5rem 2rem;">
            <span class="close-modal" style="top: 1.2rem; right: 1.2rem;">&times;</span>
            <div style="margin-bottom: 1.5rem;">
            <span style="display: inline-block; background: linear-gradient(135deg, var(--green-500) 60%, var(--orange-400) 100%); color: var(--black-900); border-radius: 50%; width: 64px; height: 64px; line-height: 64px; font-size: 2.5rem; box-shadow: 0 4px 16px rgba(var(--green-500-rgb), 0.25);">
                &#10003;
            </span>
            </div>
            <h2 style="margin-bottom: 1rem;" data-i18n="price-confirm.title">Great Price!</h2>
            <div style="background: rgba(var(--green-500-rgb), 0.12); border-radius: 12px; padding: 1.2rem 0; margin-bottom: 1.5rem;">
                <p id="price-confirmation-text" style="font-size: 1.3rem; color: var(--primary-color); font-weight: 600; margin: 0;"></p>
            </div>
            <p style="color: var(--text-light); margin-bottom: 2rem;" data-i18n="price-confirm.reserve">Ready to reserve your spot at this price?</p>
            <a href="waitlist.html" class="cta-button cta-primary" id="reserve-spot-btn" style="width: 100%; max-width: 320px; margin: 0 auto; display: block;" data-i18n="price-confirm.cta">Reserve for this price</a>
        </div>
    </div>





    <!-- Feature Modal -->
    <div id="featureModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div class="modal-body">
                <div class="modal-icon" id="modalIcon"></div>
                <h2 id="modalTitle"></h2>
                <div id="modalDescription"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p data-i18n="footer.copyright">&copy; <span id="current-year"></span> Timepot. All rights reserved.</p>
            <div class="footer-links">
                <a href="waitlist.html" data-i18n="waitlist.cta">Join Waitlist</a>
            </div>
        </div>
    </footer>
    <script src="tracking.js"></script>
    <script>
        // Set current year
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Onboarding logic
        const onboardingSection = document.getElementById('onboarding');
        const featuresSection = document.getElementById('features');
        const pricingSection = document.getElementById('pricing');
        const noKidsBtn = document.getElementById('no-kids');
        const continueBtn = document.getElementById('continue-to-features');
        const skipBtn = document.getElementById('skip-onboarding');
        
        let selectedFamilySize = null;
        let selectedDeviceAge = null;

        // Check if user has already completed onboarding
        const hasCompletedOnboarding = localStorage.getItem('timepot-onboarding-completed');
        
        if (hasCompletedOnboarding) {
            // Show features and pricing directly
            onboardingSection.style.display = 'none';
            featuresSection.style.display = 'block';
            pricingSection.style.display = 'block';
        } else {
            // Show onboarding
            onboardingSection.style.display = 'block';
            featuresSection.style.display = 'none';
            pricingSection.style.display = 'none';
        }

        // Handle family size selection
        document.querySelectorAll('[data-family-size]').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all family size buttons
                document.querySelectorAll('[data-family-size]').forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                selectedFamilySize = this.getAttribute('data-family-size');
                checkContinueButton();
            });
        });

        // Handle device age selection (MULTIPLE SELECTION)
        document.querySelectorAll('[data-device-age]').forEach(btn => {
            btn.addEventListener('click', function() {
                // Toggle active class (multiple selection allowed)
                this.classList.toggle('active');
                // Update selected device ages array
                selectedDeviceAge = Array.from(document.querySelectorAll('[data-device-age].active')).map(b => b.getAttribute('data-device-age'));
                checkContinueButton();
            });
        });

        function checkContinueButton() {
            if (selectedFamilySize && selectedDeviceAge) {
                continueBtn.disabled = false;
                continueBtn.style.opacity = '1';
            } else {
                continueBtn.disabled = true;
                continueBtn.style.opacity = '0.6';
            }
        }

        // Continue to features
        continueBtn.addEventListener('click', function() {
            if (selectedFamilySize && selectedDeviceAge) {
                // Store user preferences
                const userPreferences = {
                    familySize: selectedFamilySize,
                    deviceAge: selectedDeviceAge,
                    completedAt: new Date().toISOString()
                };
                localStorage.setItem('timepot-user-preferences', JSON.stringify(userPreferences));
                localStorage.setItem('timepot-onboarding-completed', 'true');
                
                // Track onboarding completion
                if (typeof trackEvent === 'function') {
                    trackEvent('onboarding-completed', {
                        family_size: selectedFamilySize,
                        device_age: selectedDeviceAge
                    });
                }
                
                // Show features and pricing
                onboardingSection.style.display = 'none';
                featuresSection.style.display = 'block';
                pricingSection.style.display = 'block';
                
                // Smooth scroll to features
                featuresSection.scrollIntoView({ behavior: 'smooth' });
            }
        });

        // Skip onboarding
        skipBtn.addEventListener('click', function() {
            localStorage.setItem('timepot-onboarding-completed', 'true');
            
            // Track skip
            if (typeof trackEvent === 'function') {
                trackEvent('onboarding-skipped');
            }
            
            // Show features and pricing
            onboardingSection.style.display = 'none';
            featuresSection.style.display = 'block';
            pricingSection.style.display = 'block';
        });

        // Skip onboarding
        noKidsBtn.addEventListener('click', function() {
            localStorage.setItem('timepot-onboarding-completed', 'true');

            // Track skip
            if (typeof trackEvent === 'function') {
                trackEvent('onboarding-no-kids');
            }

            // Show features and pricing
            onboardingSection.style.display = 'none';
            featuresSection.style.display = 'block';
            pricingSection.style.display = 'block';
        });

        // Feature card tracking
        document.getElementById('feature-card-team-battle').addEventListener('click', () => trackEvent('feature-card-family-challenge-click'));
        document.getElementById('feature-card-privacy-first').addEventListener('click', () => trackEvent('feature-card-privacy-first-click'));
        document.getElementById('feature-card-heroes-villains').addEventListener('click', () => trackEvent('feature-card-heroes-villains-click'));
        document.getElementById('feature-card-individual-battle').addEventListener('click', () => trackEvent('feature-card-individual-battle-click'));
        document.getElementById('feature-card-agreements').addEventListener('click', () => trackEvent('feature-card-agreements-click'));
        document.getElementById('feature-card-family-family').addEventListener('click', () => trackEvent('feature-card-family-family-click'));
        document.getElementById('waitlist-button-features').addEventListener('click', () => trackEvent('waitlist-button-features-click'));

        // Track navigation clicks
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', (e) => {
                const linkText = e.target.textContent.toLowerCase().replace(/\s+/g, '-');
                trackEvent(`nav-${linkText}-click`);
            });
        });

        // Track footer clicks
        document.querySelectorAll('.footer-links a').forEach(link => {
            link.addEventListener('click', (e) => {
                const linkText = e.target.textContent.toLowerCase().replace(/\s+/g, '-');
                trackEvent(`footer-${linkText}-click`);
            });
        });

        const cards = document.querySelectorAll('.feature-card');


        // Modal functionality
        const modal = document.getElementById('featureModal');
        const modalIcon = document.getElementById('modalIcon');
        const modalTitle = document.getElementById('modalTitle');
        const modalDescription = document.getElementById('modalDescription');
        const modalClose = document.querySelector('.modal-close');

        const featureDetails = {
            'feature-card-heroes-villains': {
                icon: '<img src="assets/icons_timepot-04.svg" alt="Heroes & Villains Icon" style="width:3.5rem;height:3.5rem;vertical-align:middle;" />',
                titleKey: 'feature.heroes-villains.modal.title',
                descriptionKey: 'feature.heroes-villains.modal.description',
                audio: 'feature.heroes-villains.modal.audio'
            },

            'feature-card-agreements': {
                icon: '<img src="assets/icons_timepot-01.svg" alt="Heroes & Villains Icon" style="width:3.5rem;height:3.5rem;vertical-align:middle;" />',
                titleKey: 'feature.agreements.modal.title',
                descriptionKey: 'feature.agreements.modal.description',
                audio: 'feature.agreements.modal.audio'
            },

            'feature-card-privacy-first': {
                icon: '<img src="assets/icons_timepot-03.svg" alt="Heroes & Villains Icon" style="width:3.5rem;height:3.5rem;vertical-align:middle;" />',
                titleKey: 'feature.privacy.modal.title',
                descriptionKey: 'feature.privacy.modal.description',
                audio: 'feature.privacy.modal.audio'
            },

            'feature-card-individual-battle': {
                icon: '<img src="assets/icons_timepot-06.svg" alt="Heroes & Villains Icon" style="width:3.5rem;height:3.5rem;vertical-align:middle;" />',
                titleKey: 'feature.individual.modal.title',
                descriptionKey: 'feature.individual.modal.description',
                audio: 'feature.individual.modal.audio'
            },

            'feature-card-team-battle': {
                icon: '<img src="assets/icons_timepot-07.svg" alt="Heroes & Villains Icon" style="width:3.5rem;height:3.5rem;vertical-align:middle;" />',
                titleKey: 'feature.team.modal.title',
                descriptionKey: 'feature.team.modal.description',
                audio: 'feature.team.modal.audio'
            },

            'feature-card-family-family': {
                icon: '<img src="assets/icons_timepot-08.svg" alt="Heroes & Villains Icon" style="width:3.5rem;height:3.5rem;vertical-align:middle;" />',
                titleKey: 'feature.family-vs-family.modal.title',
                descriptionKey: 'feature.family-vs-family.modal.description',
                audio: 'feature.family-vs-family.modal.audio'
            }
        };

        // Add click handlers to all feature cards
        cards.forEach(card => {
            card.style.cursor = 'pointer';
            card.addEventListener('click', function() {
                const cardId = this.id;
                const feature = featureDetails[cardId];
                
                if (feature) {
                    modalIcon.innerHTML = feature.icon;
                    modalTitle.textContent = window.i18n ? window.i18n.translate(feature.titleKey) : feature.titleKey;
                    modalDescription.innerHTML = `<p>${window.i18n ? window.i18n.translate(feature.descriptionKey) : feature.descriptionKey}</p>`;
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';

                    if (feature.audio) {
                        const audioText = (window.i18n && typeof window.i18n.translate === 'function')
                            ? window.i18n.translate('feature.modal.audio-text')
                            : 'Let Anton explain it. Hit the play button!';

                        let audioSrc = feature.audio;

                        const isPath = typeof feature.audio === 'string' && (
                            feature.audio.startsWith('assets/') ||
                            feature.audio.startsWith('./') ||
                            feature.audio.startsWith('/') ||
                            /\.(mp3|wav|ogg|m4a)$/i.test(feature.audio)
                        );

                        if (!isPath && window.i18n && typeof window.i18n.translate === 'function') {
                            const translated = window.i18n.translate(feature.audio);
                            if (translated && translated !== feature.audio) {
                                audioSrc = translated;
                            }
                        }

                        modalDescription.innerHTML += `
                            <p style="margin-top:2rem;">${audioText}</p>
                            <audio controls style="margin-top:1rem; width:100%;">
                                <source src="${audioSrc}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        `;
                    }
                    
                    // Track modal open
                    if (typeof trackEvent === 'function') {
                        trackEvent(`${cardId}-modal-open`);
                    }
                }
            });
        });

        // Close modal handlers
        modalClose.addEventListener('click', () => {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });

        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.style.display === 'flex') {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        // Track modal CTA clicks
        const modalCTA = document.querySelector('.modal-cta');
        if (modalCTA) {
            modalCTA.addEventListener('click', () => {
                const currentFeature = modalTitle.textContent.toLowerCase().replace(/\s+/g, '-').replace(/&/g, 'and');
                trackEvent(`modal-cta-${currentFeature}-click`);
            });
        }

        // CTA 6: Submit pricing input
        document.getElementById('submit-price-btn').addEventListener('click', function() {
            const priceInput = document.getElementById('user-price-input');
            const price = parseFloat(priceInput.value);
            
            // Validate input
            if (!price || price < 0) {
                alert('Please enter a valid price');
                return;
            }
            
            // Track the pricing submission
            trackEvent('cta-6-price-submit', { price: price });
            
            // Store price for later use
            sessionStorage.setItem('userPrice', price);
            
            // Show confirmation modal
            document.getElementById('price-confirmation-text').textContent = `You'd pay CHF ${price.toFixed(2)}/month`;
            document.getElementById('price-confirmation-modal').style.display = 'flex';
        });

        // CTA 7: Reserve spot at stated price
        document.getElementById('reserve-spot-btn').addEventListener('click', function(e) {
            e.preventDefault();
            const price = sessionStorage.getItem('userPrice');
            const currency = sessionStorage.getItem('userCurrency') || 'CHF';
            
            trackEvent('cta-7-reserve-at-price', { price: price, currency: currency });
            
            // Redirect to waitlist with price parameter
            window.location.href = `waitlist.html?price=${price}&currency=${currency}`;
        });

        // Modal close handlers for price confirmation
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', function() {
                this.closest('.modal').style.display = 'none';
            });
        });

        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', function() {
                this.closest('.modal').style.display = 'none';
            });
        });

        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    </script>
    <script>
        // Dynamic Currency Handling
        const currencySpan = document.getElementById('currency-symbol');
        const priceConfirmationText = document.getElementById('price-confirmation-text');
        const priceInput = document.getElementById('user-price-input');

        function getCurrencyForLang(lang) {
            const langPart = lang.split('-')[0];
            const regionPart = (lang.split('-')[1] || '').toUpperCase();

            if (regionPart === 'CH') return 'CHF';
            if (regionPart === 'US') return 'USD';
            if (regionPart === 'GB') return 'GBP';
            if (langPart === 'de' || regionPart === 'AT' || regionPart === 'BE' || regionPart === 'CY' || regionPart === 'EE' || regionPart === 'FI' || regionPart === 'FR' || regionPart === 'GR' || regionPart === 'IE' || regionPart === 'IT' || regionPart === 'LV' || regionPart === 'LT' || regionPart === 'LU' || regionPart === 'MT' || regionPart === 'NL' || regionPart === 'PT' || regionPart === 'SK' || regionPart === 'SI' || regionPart === 'ES') return 'EUR';
            
            return 'USD'; // Default currency
        }

        function formatCurrency(amount, currency, lang) {
            return new Intl.NumberFormat(lang, {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const userLang = window.i18n.getCurrentLanguage();
            const currency = getCurrencyForLang(userLang);

            sessionStorage.setItem('userCurrency', currency);

            // Update currency symbol in the input
            if (currencySpan) {
                currencySpan.textContent = currency;
            }

            // Update price confirmation modal text
            const submitPriceBtn = document.getElementById('submit-price-btn');
            if (submitPriceBtn) {
                submitPriceBtn.addEventListener('click', function() {
                    const price = parseFloat(priceInput.value);
                    if (price && price >= 0) {
                        const formattedPrice = formatCurrency(price, currency, userLang);
                        priceConfirmationText.textContent = `You'd pay ${formattedPrice}/month`;
                        
                        // Also update the tracking event with currency
                        trackEvent('cta-6-price-submit', { price: price, currency: currency });
                    }
                });
            }
        });
    </script>
</body>
</html>